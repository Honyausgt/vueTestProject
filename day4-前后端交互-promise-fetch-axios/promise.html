<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Document</title>
</head>

<body>

</body>
<script src="../vue.js"></script>
<script>
    // //promise .then函数的返回值
    // function queryData() {
    //     return new Promise((resolve, reject) => {
    //         setTimeout(() => {
    //             let score = Math.random()
    //             resolve(score)
    //         }, 2000);
    //     })
    // }

    // queryData()
    //     .then(data => {
    //         console.log("first" + data);
    //         return queryData()
    //     })
    //     .then(info => {
    //         //当返回一个普通值时会默认返回一个promise对象，
    //         //而该普通值会作为resolve中的值返回
    //         console.log("second" + info);
    //         return 'gameover'
    //     })
    //     .then(res => {
    //         // 当没有返回任何值时，下一步then则输出undefined
    //         console.log("result" + res)
    //     }).then(novalueRes => {

    //         console.log("novalueRes:" + novalueRes);
    //     })

    // //Promise对象的方法
    // const p1 = setTimeout(() => {
    //     console.log("我是p1")
    // }, 1500);

    // const p2 = setTimeout(() => {
    //     console.log("我是p2")
    // }, 5500);

    // const p3 = setTimeout(() => {
    //     console.log("我是p3")
    // }, 500);

    function getData(url) {
        const req = new Promise((res, rej) => {
            const xhr = new XMLHttpRequest()
            xhr.open('get', url)
            xhr.send()

            xhr.onreadystatechange = () => {
                if (xhr.readyState != 4) return;
                if (xhr.readyState == 4 && xhr.status == 200) {
                    res(xhr.responseText)
                } else {
                    rej('error!!!')
                }
            }
        })
        return req
    }

    const req1 = getData("http://127.0.0.1:3000/books")
    const req2 = getData("http://127.0.0.1:3000/books/2")
    const req3 = getData("http://127.0.0.1:3000/books/book/三国演义")

    // all方法只有在所有任务执行完毕才能得到结果
    Promise.all([req1, req2, req3])
        .then(res => {
            console.log(res)
        })

    Promise.race([req1, req2, req3])
        .then(res => {
            console.log(res);
        })
</script>

</html>